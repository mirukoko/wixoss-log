<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WIXOSS MATCH LOG</title>

<style>
/* ============================
   å…¨ä½“ï¼ˆãƒ€ãƒ¼ã‚¯èƒŒæ™¯ãƒ»ç™½æ–‡å­—ï¼‰
============================ */
body{
  margin:0;
  padding:16px;
  font-family:system-ui,sans-serif;
  background:#0a0c14;
  color:#e3e7ff;
}

h1{
  margin:0 0 1em;
  font-size:1.6rem;
  text-align:center;
  color:#42a5f5;
}

/* ============================
   èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³ï¼ˆè»½é‡ï¼‰
============================ */
#loadJsonBtn{
  display:block;
  width:100%;
  padding:12px;
  background:#1e88e5;
  color:#fff;
  border:none;
  border-radius:8px;
  font-size:1rem;
  margin-bottom:16px;
}

/* ============================
   ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆå…ƒã®è‰²ã«è¿‘ã„è»½é‡ç‰ˆï¼‰
============================ */
.frame{
  background:#141824;
  border:1px solid rgba(192,198,216,.4);
  border-radius:10px;
  padding:12px;
  margin-bottom:16px;
}

.frame-title{
  font-size:1rem;
  margin-bottom:8px;
  color:#42a5f5;
}

/* ============================
   ã‚°ãƒ©ãƒ•ï¼ˆå…ƒã®é…ç½®ï¼‰
============================ */
.charts-container{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  justify-content:center;
}

.chart-box{
  background:#181c2a;
  border:1px solid rgba(192,198,216,.4);
  border-radius:8px;
  padding:4px;
  width:110px;
  text-align:center;
}

.chart-box canvas{
  width:100px !important;
  height:100px !important;
}

.chart-title{
  font-size:.75rem;
  margin-bottom:4px;
  color:#9fa6c5;
}

.chart-note{
  font-size:.7rem;
  margin-top:4px;
  color:#9fa6c5;
}

/* ============================
   ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå…ƒã®è‰²ã‚’ç¶­æŒï¼‰
============================ */
.table-wrapper{
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}

table{
  width:100%;
  border-collapse:collapse;
  font-size:.85rem;
  min-width:900px;
}

th{
  background:#283a5a;
  font-size:.75rem;
  padding:6px 8px;
  border:1px solid rgba(192,198,216,.3);
}

td{
  padding:6px 8px;
  border:1px solid rgba(192,198,216,.3);
}

tr:hover td{
  background:#1a2330;
}

.lose-row{
  background:#1b2230;
}

/* ============================
   å‚™è€ƒæ¬„ï¼ˆå…ƒã®è‰² Ã— è»½é‡ï¼‰
============================ */
td:nth-child(7){
  min-width:248px;
  max-width:248px;
}

.note-toggle{
  cursor:pointer;
  color:#E6D37A;
  user-select:none;
}

.note-content{
  margin-top:6px;
  padding:6px;
  background:#141824;
  border:1px solid rgba(192,198,216,.4);
  border-radius:6px;
  width:256px;
  box-sizing:border-box;

  max-height:0;
  opacity:0;
  overflow:hidden;
  transition:max-height 0.3s ease, opacity 0.3s ease;
}

.note-divider{
  border-top:1px dashed rgba(192,198,216,.5);
  margin:4px 0;
}

.note-reflect{
  color:#E6D37A;
}

/* ============================
   ã‚¹ãƒãƒ›æœ€é©åŒ–
============================ */
@media (max-width:600px){
  table{
    font-size:1rem;
  }
  .note-content{
    width:100%;
  }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<h1>WIXOSS MATCH LOG</h1>

<button id="loadJsonBtn">JSON ã‚’èª­ã¿è¾¼ã‚€ï¼ˆOneDrive ã‹ã‚‰é¸æŠï¼‰</button>

<!-- â–¼ FILTER -->
<div class="frame">
  <div class="frame-title">FILTER</div>
  <select id="filterLrig" style="width:100%;padding:8px;border-radius:6px;">
    <option value="">ï¼ˆã™ã¹ã¦è¡¨ç¤ºï¼‰</option>
  </select>

  <div class="charts-container">

    <div class="chart-box">
      <div class="chart-title">å…ˆè¡Œ å‹ç‡</div>
      <canvas id="firstChart"></canvas>
      <div class="chart-note" id="firstSummary"></div>
    </div>

    <div class="chart-box">
      <div class="chart-title">å¾Œæ”» å‹ç‡</div>
      <canvas id="secondChart"></canvas>
      <div class="chart-note" id="secondSummary"></div>
    </div>

    <div class="chart-box">
      <div class="chart-title">åˆè¨ˆ å‹ç‡</div>
      <canvas id="totalChart"></canvas>
      <div class="chart-note" id="totalSummary"></div>
    </div>

  </div>
</div>

<!-- â–¼ MATCH LOG -->
<div class="frame">
  <div class="frame-title">MATCH LOG</div>
  <div class="table-wrapper">
    <table id="matchTable">
      <thead>
        <tr>
          <th>æ—¥ä»˜</th><th>å ´æ‰€</th><th>è‡ªåˆ†</th><th>ç›¸æ‰‹</th>
          <th>å…ˆå¾Œ</th><th>å‹æ•—</th><th>å‚™è€ƒ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
/* ======== JSï¼ˆæ©Ÿèƒ½ã¯ãã®ã¾ã¾ï¼‰ ======== */

let matches=[];
let firstChart=null, secondChart=null, totalChart=null;

document.getElementById("loadJsonBtn").addEventListener("click", ()=>{
  const input=document.createElement("input");
  input.type="file";
  input.accept=".json,application/json";
  input.style.display="none";
  document.body.appendChild(input);

  input.addEventListener("change", async e=>{
    const file=e.target.files[0];
    if(!file){
      document.body.removeChild(input);
      return;
    }
    const text=await file.text();
    matches=JSON.parse(text);

    renderFilterOptions();
    renderTable();

    document.body.removeChild(input);
  });

  input.click();
});

function normalizeLrig(name){ return name.replace(/ï¼ˆ.*?ï¼‰/g,""); }

function renderFilterOptions(){
  const set=new Set(matches.map(m=>normalizeLrig(m.myLrig)).filter(Boolean));
  const sel=document.getElementById("filterLrig");
  sel.innerHTML='<option value="">ï¼ˆã™ã¹ã¦è¡¨ç¤ºï¼‰</option>';
  set.forEach(l=>{
    const o=document.createElement("option");
    o.value=l; o.textContent=l;
    sel.appendChild(o);
  });
}

function renderTable(filter=""){
  const tb=document.querySelector("#matchTable tbody");
  tb.innerHTML="";

  matches.sort((a,b)=>new Date(b.date)-new Date(a.date));

  matches.forEach(m=>{
    if(filter && normalizeLrig(m.myLrig)!==filter) return;

    const tr=document.createElement("tr");
    if(m.result==="è² ã‘") tr.classList.add("lose-row");

    tr.innerHTML=`
      <td>${m.date}</td>
      <td>${m.place}</td>
      <td>${m.myLrig}</td>
      <td>${m.oppLrig}</td>
      <td>${m.order}</td>
      <td>${m.result}</td>
      <td>
        <div class="note-toggle">â–¶ å‚™è€ƒã‚’é–‹ã</div>
        <div class="note-content" data-open="false">
          <div>ğŸ“ ${m.noteResult || ""}</div>
          <div class="note-divider"></div>
          <div class="note-reflect">ğŸ’¡ ${m.noteReflect || ""}</div>
        </div>
      </td>
    `;
    tb.appendChild(tr);
  });

  tb.querySelectorAll(".note-toggle").forEach(toggle=>{
    toggle.addEventListener("click",()=>{
      const content = toggle.nextElementSibling;
      const isOpen = content.dataset.open === "true";

      if(isOpen){
        content.style.maxHeight = "0px";
        content.style.opacity = "0";
        content.dataset.open = "false";
        toggle.textContent = "â–¶ å‚™è€ƒã‚’é–‹ã";
      }else{
        const h = content.scrollHeight;
        content.style.maxHeight = h + "px";
        content.style.opacity = "1";
        content.dataset.open = "true";
        toggle.textContent = "â–¼ å‚™è€ƒã‚’é–‰ã˜ã‚‹";
      }
    });
  });

  updateCharts(filter);
}

function updateCharts(filter=""){
  let fw=0,fl=0,sw=0,sl=0;

  matches.forEach(m=>{
    if(filter && normalizeLrig(m.myLrig)!==filter) return;

    if(m.order==="å…ˆè¡Œ"){
      if(m.result==="å‹ã¡") fw++; else fl++;
    } else {
      if(m.result==="å‹ã¡") sw++; else sl++;
    }
  });

  const tw=fw+sw, tl=fl+sl;
  const red="#e53935", blue="#1e88e5";

  if(firstChart) firstChart.destroy();
  if(secondChart) secondChart.destroy();
  if(totalChart) totalChart.destroy();

  firstChart=new Chart(document.getElementById("firstChart"),{
    type:"doughnut",
    data:{labels:["å‹ã¡","è² ã‘"],datasets:[{data:[fw,fl],backgroundColor:[red,blue]}]}
  });

  secondChart=new Chart(document.getElementById("secondChart"),{
    type:"doughnut",
    data:{labels:["å‹ã¡","è² ã‘"],datasets:[{data:[sw,sl],backgroundColor:[red,blue]}]}
  });

  totalChart=new Chart(document.getElementById("totalChart"),{
    type:"doughnut",
    data:{labels:["å‹ã¡","è² ã‘"],datasets:[{data:[tw,tl],backgroundColor:[red,blue]}]}
  });

  document.getElementById("firstSummary").textContent =
    fw+fl ? `å‹ç‡ ${Math.round(fw/(fw+fl)*100)}%` : "ãƒ‡ãƒ¼ã‚¿ãªã—";

  document.getElementById("secondSummary").textContent =
    sw+sl ? `å‹ç‡ ${Math.round(sw/(sw+sl)*100)}%` : "ãƒ‡ãƒ¼ã‚¿ãªã—";

  document.getElementById("totalSummary").textContent =
    tw+tl ? `å‹ç‡ ${Math.round(tw/(tw+tl)*100)}%` : "ãƒ‡ãƒ¼ã‚¿ãªã—";
}

document.getElementById("filterLrig").addEventListener("change",e=>{
  renderTable(e.target.value);
});
</script>

</body>
</html>
